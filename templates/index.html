<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy Trade Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
    {% if profile_info %}
    <a href="/accounts" class="profile-info">
        <div class="profile-name">{{ profile_info.name }}</div>
        <div class="profile-accounts">
            <span>{{ profile_info.strategies_count }}</span> Strategies •
            <span>{{ profile_info.copiers_count }}</span> Copiers
        </div>
    </a>
    {% endif %}

    <div class="card">
        <!-- Hero Section: The Anchor -->
        <div class="hero-section">
            <div class="badge">#1 Spotlight</div>
            <div class="strategy-name">{{ strategy.name }}</div>
            <div class="inception-date">Trading since <span>{{ inception_display }}</span></div>

            <!-- Account Selector -->
            {% if accounts_list %}
            <div class="account-selector-wrapper">
                <div class="account-selector-label">Account</div>
                <select id="accountSelector" class="account-selector" onchange="handleAccountChange()">
                    <option value="" disabled selected>Select account</option>
                    {% for acc in accounts_list %}
                    <option value="{{ acc.id }}" data-type="{{ acc.type }}">
                        {{ acc.name }} • {{ acc.server }} • {{ acc.username }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            <!-- Main Performance Stats -->
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-value">{{ '%.2f'|format(strategy.return_val) }}%</div>
                    <div class="stat-label">Total Return</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">{{ '{:,}'.format(strategy.copiers) }}</div>
                    <div class="stat-label">Copiers</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">{{ fee_display }}</div>
                    <div class="stat-label">Performance Fee</div>
                </div>
            </div>

            <!-- Page Tabs -->
            <div class="page-tabs">
                <button id="pageTabOverview" class="page-tab-btn active" type="button" onclick="showPageTab('overview')">Overview</button>
                <button id="pageTabTrades" class="page-tab-btn" type="button" onclick="showPageTab('trades')">Trades</button>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-sections">

            <div id="overviewSection" class="page-section active">

                <!-- Trade Performance Section -->
                <div class="trades-section">
                    <div class="section-title">TRADE PERFORMANCE</div>
                    <div class="trades-grid">
                        <div class="trade-stat">
                            <div class="trade-stat-value">{{ '{:,}'.format(strategy.total_trades) }}</div>
                            <div class="trade-stat-label">Total Trades</div>
                        </div>
                        <div class="trade-stat">
                            <div class="trade-stat-value">{{ '{:,}'.format(strategy.min_per_month) }}</div>
                            <div class="trade-stat-label">Min / Month</div>
                        </div>
                        <div class="trade-stat">
                            <div class="trade-stat-value">{{ '{:,}'.format(strategy.max_per_month) }}</div>
                            <div class="trade-stat-label">Max / Month</div>
                        </div>
                    </div>
                    <div class="win-loss-row">
                        <div class="trade-stat">
                            <div class="trade-stat-value">{{ '{:,}'.format(strategy.wins) }}</div>
                            <div class="trade-stat-label">Wins</div>
                        </div>
                        <div class="trade-stat">
                            <div class="trade-stat-value">{{ '{:,}'.format(strategy.losses) }}</div>
                            <div class="trade-stat-label">Losses</div>
                        </div>
                        <div class="trade-stat">
                            <div class="trade-stat-value">{{ '%.1f'|format(strategy.win_rate) }}%</div>
                            <div class="trade-stat-label">Win Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Profitability & Risk Section -->
                <div class="profitability-section">
                    <div class="section-title">PROFITABILITY & RISK</div>
                    <div class="profit-grid">
                        <div class="profit-stat">
                            <div class="profit-stat-value">{{ format_currency(strategy.realised_pnl, strategy.currency_code) }}</div>
                            <div class="profit-stat-label">Realised P&L</div>
                        </div>
                        <div class="profit-stat">
                            <div class="profit-stat-value">{{ format_currency(strategy.unrealised_pnl, strategy.currency_code) }}</div>
                            <div class="profit-stat-label">Unrealised P&L</div>
                        </div>
                        <div class="profit-stat">
                            <div class="profit-stat-value">{{ '%.2f'|format(strategy.max_drawdown) }}%</div>
                            <div class="profit-stat-label">Max Drawdown</div>
                        </div>
                    </div>
                </div>

                <!-- Account Status Section -->
                <div class="account-section">
                    <div class="section-title">ACCOUNT STATUS</div>
                    <div class="account-grid">
                        <div class="account-stat">
                            <div class="account-stat-value">{{ format_currency(strategy.balance, strategy.currency_code) }}</div>
                            <div class="account-stat-label">Balance</div>
                        </div>
                        <div class="account-stat">
                            <div class="account-stat-value">{{ format_currency(strategy.equity, strategy.currency_code) }}</div>
                            <div class="account-stat-label">Equity</div>
                        </div>
                        <div class="account-stat">
                            <div class="account-stat-value">1:{{ strategy.leverage }}</div>
                            <div class="account-stat-label">Leverage</div>
                        </div>
                    </div>
                </div>

                <!-- Copiers Performance Section -->
                <div class="copiers-section">
                    <div class="section-title">COPIERS PERFORMANCE</div>
                    <div class="copiers-grid">
                        <div class="copier-stat">
                            <div class="copier-stat-value">{{ format_currency(strategy.copiers_year_profit, strategy.currency_code) }}</div>
                            <div class="copier-stat-label">Year Profit</div>
                        </div>
                        <div class="copier-stat">
                            <div class="copier-stat-value">{{ format_currency(strategy.copiers_month_profit, strategy.currency_code) }}</div>
                            <div class="copier-stat-label">Month Profit</div>
                        </div>
                        <div class="copier-stat">
                            <div class="copier-stat-value">{{ format_currency(strategy.copiers_total_balance, strategy.currency_code) }}</div>
                            <div class="copier-stat-label">Total AUM</div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="tradesSection" class="page-section">
                <div class="section-title" style="margin-top: 10px;">TRADES</div>
                <div class="trades-tabs">
                    <button id="tabOpen" class="tab-btn active" type="button" onclick="showTradesTab('open')">Open</button>
                    <button id="tabClosed" class="tab-btn" type="button" onclick="showTradesTab('closed')">Closed</button>
                </div>

                <div id="panelOpen" class="trades-panel active">
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Lots</th>
                                <th>Open Price</th>
                                <th class="muted">Open Time</th>
                                <th>PnL</th>
                            </tr>
                        </thead>
                        <tbody id="openTradesBody">
                            <tr>
                                <td>EURUSD</td>
                                <td><span class="pill buy">Buy</span></td>
                                <td>0.10</td>
                                <td>1.08540</td>
                                <td class="muted">2025-12-12 12:21</td>
                                <td>+12.34</td>
                            </tr>
                            <tr>
                                <td>XAUUSD</td>
                                <td><span class="pill sell">Sell</span></td>
                                <td>0.05</td>
                                <td>2043.20</td>
                                <td class="muted">2025-12-12 10:03</td>
                                <td>-5.12</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="panelClosed" class="trades-panel">
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Lots</th>
                                <th>Open</th>
                                <th>Close</th>
                                <th>PnL</th>
                            </tr>
                        </thead>
                        <tbody id="closedTradesBody">
                            <tr>
                                <td>GBPUSD</td>
                                <td><span class="pill buy">Buy</span></td>
                                <td>0.20</td>
                                <td>1.26310</td>
                                <td>1.26850</td>
                                <td>+108.00</td>
                            </tr>
                            <tr>
                                <td>US30</td>
                                <td><span class="pill sell">Sell</span></td>
                                <td>0.01</td>
                                <td>38210</td>
                                <td>38130</td>
                                <td>+80.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <button class="copy-btn hidden">Copy Strategy</button>
            <p style="font-size: 10px; color: #95a5a6; margin-top: 20px;">
                <a href="/logout" style="color: #7f8c8d; text-decoration: none;">Logout</a>
            </p>

        </div> <!-- End content-sections -->
    </div> <!-- End card -->

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
